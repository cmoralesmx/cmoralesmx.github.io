<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Legion 5P, Linux support | Carlos A. Morales</title> <meta name="author" content="Carlos A. Morales"/> <meta name="description" content="Linux support in the Lenovo Legion 5P"/> <meta name="keywords" content="cloud-solutions-architect, cloud-architect, cloud-engineer, cloud-consultant"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Serif:300,400,500,700|Roboto+Slab:300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://cmoralesmx.github.io/blog/2020/legion-5P-linux-support/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Carlos </span>A. Morales</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item"> <a class="nav-link" href="https://resume.cm-cloudarchitect.com" target="_blank" rel="noopener noreferrer">Resume </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Legion 5P, Linux support</h1> <p class="post-meta">October 24, 2020</p> <p class="post-tags"> <a href="/blog/2020"> <i class="fas fa-calendar fa-sm"></i> 2020 </a>   ·   <a href="/blog/tag/linux"> <i class="fas fa-hashtag fa-sm"></i> linux</a>   </p> </header> <article class="post-content"> <p>The specific model I will cover in this post is a Lenovo Legion 5P-15ARH05H. The distribution in use is Manjaro Linux with an initial setup done using media version 20.1</p> <div class="row mt-3 mb-3"> <div class="col-sm-2"></div> <div class="col-sm-8"> <img class="img-fluid rounded z-depth-1" src="/assets/img/2020-10-24-manjaro.png"> </div> <div class="col-sm-2"></div> </div> <p>Setting up Manjaro was a trivial task. The automated setup completed without a hitch in about 10-15 minutes without a live internet connection.</p> <p>After rebooting, I was gladly surprised when I realized the nvidia drivers were already installed even though the setup was done offline! Not that installing those drivers was especially hard in the last few years as prior versions required doing,</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pacman -Syu
$ sudo mhw -a pci nonfree 0300
</code></pre></div></div> <p>Not having to worry about these after setup seems like a positive step for Manjaro. Anyway, on with the post.</p> <p>Apart from the discrete GPU, most of the hardware was correctly identified by the kernel. There were two hardware-support issues I had to handle myself and one feature which I think must be changed so I count this as an issue too.</p> <p>Next is a list of issues fixed with links to the fixing procedures</p> <h2 id="issues-fixed">Issues fixed.</h2> <ul> <li><a href="#noisy-pc-speaker-on-errors">Noisy PC speaker on errors</a></li> <li><a href="/blog/2020/legion-5P-touchpad-nonresponsive-fix.html">Touchpad non responsive</a></li> <li>Hybrid graphics causing blank HDMI-out <ul> <li><a href="#hdmi-out-with-discrete-graphics-and-brightness-control">Solution using discrete graphics only</a></li> <li><a href="/blog/2020/legion-5P-hdmi-out-with-hybrid-graphics.html">Solution patching the kernel to fix the hybrid mode</a></li> <li><a href="/blog/2022/legion-5P-hybrid-graphics">Fixed upstream</a></li> </ul> </li> </ul> <blockquote> <p>Updated on November 2022: HDMI-out with hybrid graphics is not an issue any more for this computer. Here’s my <a href="/blog/2022/legion-5P-hybrid-graphics">post</a> about it</p> </blockquote> <hr> <h3 id="noisy-pc-speaker-on-errors">Noisy PC speaker on errors</h3> <p>The PC speaker can be easily disabled globally, by executing as ROOT</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># echo "blacklist pcspkr" | tee /etc/modprobe.d/nobeep.conf
</code></pre></div></div> <hr> <h3 id="hdmi-out-with-discrete-graphics-and-brightness-control">HDMI-out with discrete graphics and brightness control</h3> <p>To use discrete graphics, this must be enabled in the BIOS of the computer. After doing that, the discrete GPU will drive the HDMI-out and USB-c ports, while the Radeon graphics drive the LCD panel, but the discrete card will perform all the rendering and send the output to the corresponding buffers. Therefore, all the rendering is hardware-accelerated by the dedicated GPU.</p> <p>In this mode, the brightness control should work without issues for the internal panel by adding the following entry to the Xorg.conf:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Option "RegistryDwords" "EnableBrightnessControl=1"
</code></pre></div></div> <p>This <a href="https://unix.stackexchange.com/a/610415" target="_blank" rel="noopener noreferrer">stackexchange answer</a> suggests creating the file <code class="language-plaintext highlighter-rouge">/usr/share/X11/xorg.conf.d/10-nvidia-brightness.conf</code> with the following content,</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Section "Device"
    Identifier     "Device0"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BoardName      "RXT 2060"
    Option         "RegistryDwords" "EnableBrightnessControl=1"
EndSection
</code></pre></div></div> <p>After doing that and rebooting, brightness control should work.</p> <div class="row mt-3 mb-3"> <div class="col-sm-4"></div> <div class="col-sm-4"> <img class="img-fluid rounded z-depth-1" src="/assets/img/2020-10-24-Linux.png"> </div> <div class="col-sm-4"></div> </div> </article><div id="disqus_thread"></div> <script type="text/javascript">var disqus_shortname="think-code-cycle",disqus_identifier="/blog/2020/legion-5P-linux-support",disqus_title="Legion 5P, Linux support";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener noreferrer">comments powered by Disqus.</a> </noscript> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2022 Carlos A. Morales. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-CW7VDPN2T7"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CW7VDPN2T7");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>