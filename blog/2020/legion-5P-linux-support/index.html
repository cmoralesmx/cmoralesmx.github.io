<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Carlos A. Morales | Legion 5P, Linux support</title>
<meta name="description" content="Personal site of Carlos A. Morales, CV, Projects, Blog.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/zenburn.css" />

<!-- Styles -->
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<link rel="stylesheet" href="/assets/css/main.css">

<link rel="canonical" href="/blog/2020/legion-5P-linux-support/">

<!-- Theming-->

  <script src="/assets/js/theme.js"></script>



  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4136342-19"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-4136342-19');
  </script>


    

  </head>

  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       <span class="font-weight-bold">Carlos</span> A.  Morales
      </a>
      
      <!-- Navbar Toogle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/resume/">
                resume
                
              </a>
          </li>
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Legion 5P, Linux support</h1>
    <p class="post-meta">October 24, 2020</p>
  </header>

  <article class="post-content">
    <p>The specific model I will cover in this post is a Lenovo Legion 5P-15ARH05H.
The distribution in use is Manjaro Linux with an initial setup done using media
version 20.1</p>

<div class="row mt-3 mb-3">
    <div class="col-sm-2"></div>
    <div class="col-sm-8">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/2020-10-24-manjaro.png" />
    </div>
    <div class="col-sm-2"></div>
</div>
<p>Setting up Manjaro was a trivial task. The automated setup completed without a
hitch in about 10-15 minutes without a live internet connection.</p>

<p>After rebooting, I was gladly surprised when I realized the nvidia drivers were
already installed even though the setup was done offline! Not that installing
those drivers was especially hard in the last few years as prior versions
required doing,</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pacman -Syu
$ sudo mhw -a pci nonfree 0300
</code></pre></div></div>
<p>Not having to worry about these after setup seems like a positive step for
Manjaro. Anyway, on with the post.</p>

<p>Apart from the discrete GPU, most of the hardware was correctly identified by
the kernel. There were two hardware-support issues I had to handle myself and
one feature which I think must be changed so I count this as an issue too.</p>

<p>Next is a list of issues fixed with links to the fixing procedures</p>

<h2 id="issues-fixed">Issues fixed.</h2>
<ul>
  <li><a href="#noisy-pc-speaker-on-errors">Noisy PC speaker on errors</a></li>
  <li><a href="/blog/2020/legion-5P-touchpad-nonresponsive-fix">Touchpad non responsive</a></li>
  <li>Hybrid graphics causing blank HDMI-out
    <ul>
      <li><a href="#hdmi-out-with-discrete-graphics-and-brightess-control">Solution using discrete graphics only</a></li>
      <li><a href="/blog/2020/legion-5P-hdmi-out-with-hybrid-graphics">Solution patching the kernel to fix the hybrid mode</a></li>
    </ul>
  </li>
</ul>

<hr />
<h3 id="noisy-pc-speaker-on-errors">Noisy PC speaker on errors</h3>

<p>The PC speaker can be easily disabled globally, by executing as ROOT</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># echo "blacklist pcspkr" | tee /etc/modprobe.d/nobeep.conf
</code></pre></div></div>
<hr />
<h3 id="hdmi-out-with-discrete-graphics-and-brightness-control">HDMI-out with discrete graphics and brightness control</h3>

<p>To use discrete graphics, this must be enabled in the BIOS of the computer.
After doing that, the discrete GPU will drive the HDMI-out and USB-c ports,
while the Radeon graphics drive the LCD panel, but the discrete card will
perform all the rendering and send the output to the corresponding buffers.
Therefore, all the rendering is hardware-accelerated by the dedicated GPU.</p>

<p>In this mode, the brightness control should work without issues for the internal
panel by adding the following entry to the Xorg.conf:</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Option "RegistryDwords" "EnableBrightnessControl=1"
</code></pre></div></div>

<p>This <a href="https://unix.stackexchange.com/a/610415">stackexchange answer</a> suggests
creating the file <code class="language-plaintext highlighter-rouge">/usr/share/X11/xorg.conf.d/10-nvidia-brightness.conf</code>
with the following content,</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Section "Device"
    Identifier     "Device0"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BoardName      "RXT 2060"
    Option         "RegistryDwords" "EnableBrightnessControl=1"
EndSection
</code></pre></div></div>

<p>After doing that and rebooting, brightness control should work.</p>

<div class="row mt-3 mb-3">
  <div class="col-sm-4"></div>
  <div class="col-sm-4">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/2020-10-24-Linux.png" />
  </div>
<div class="col-sm-4"></div>
</div>

  </article>

  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'think-code-cycle';
      var disqus_identifier = '/blog/2020/legion-5P-linux-support';
      var disqus_title      = "Legion 5P, Linux support";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

</div>

    </div>

    <!-- Footer -->

    
<footer class="sticky-bottom mt-5">
  <div class="container">
    &copy; Copyright 2020 Carlos A. Morales.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

    
    Last updated: December 20, 2020.
    
  </div>
</footer>



  </body>

  <!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  

  


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>

<!-- Load DarkMode JS -->
<script src="/assets/js/dark_mode.js"></script>


</html>
